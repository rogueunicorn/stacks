{
    "TemplateBody": {
        "Outputs": {
            "PublicRouteTable": {
                "Description": "Public Route Table", 
                "Value": {
                    "Ref": "PublicRouteTable"
                }
            }, 
            "VpcId": {
                "Description": "VPC ID", 
                "Value": {
                    "Ref": "Vpc"
                }
            }, 
            "PrivateSubnetAz1": {
                "Description": "Private Subnet AZ 1", 
                "Value": {
                    "Ref": "PrivateSubnetAz1"
                }
            }, 
            "PrivateSubnetAz3": {
                "Description": "Private Subnet AZ 3", 
                "Value": {
                    "Ref": "PrivateSubnetAz3"
                }
            }, 
            "PrivateSubnetAz2": {
                "Description": "Private Subnet AZ 2", 
                "Value": {
                    "Ref": "PrivateSubnetAz2"
                }
            }, 
            "AppServerSecurityGroup": {
                "Description": "App Server SecurityGroup", 
                "Value": {
                    "Ref": "AppServerSecurityGroup"
                }
            }, 
            "PublicSubnetAz1": {
                "Description": "Public Subnet AZ 1", 
                "Value": {
                    "Ref": "PublicSubnetAz1"
                }
            }, 
            "PublicSubnetAz2": {
                "Description": "Public Subnet AZ 2", 
                "Value": {
                    "Ref": "PublicSubnetAz2"
                }
            }, 
            "PublicSubnetAz3": {
                "Description": "Public Subnet AZ 3", 
                "Value": {
                    "Ref": "PublicSubnetAz3"
                }
            }, 
            "InternetGateway": {
                "Description": "Internet Gateway", 
                "Value": {
                    "Ref": "InternetGateway"
                }
            }
        }, 
        "Parameters": {
            "Az3PrivateCidr": {
                "Default": "10.0.160.0/19", 
                "Type": "String", 
                "Description": "VPC Public CIDR Block, default is 10.0.160.0/19"
            }, 
            "Az2PrivateCidr": {
                "Default": "10.0.96.0/19", 
                "Type": "String", 
                "Description": "VPC Public CIDR Block, default is 10.0.96.0/19"
            }, 
            "Az3PublicCidr": {
                "Default": "10.0.128.0/19", 
                "Type": "String", 
                "Description": "VPC Public CIDR Block, default is 10.0.128.0/19"
            }, 
            "Az1PrivateCidr": {
                "Default": "10.0.32.0/19", 
                "Type": "String", 
                "Description": "VPC Private CIDR Block, default is 10.0.32.0/19"
            }, 
            "VpcCidr": {
                "Default": "10.0.0.0/16", 
                "Type": "String", 
                "Description": "VPC CIDR Block, default is 10.0.0.0/16"
            }, 
            "Az2PublicCidr": {
                "Default": "10.0.64.0/19", 
                "Type": "String", 
                "Description": "VPC Public CIDR Block, default is 10.0.64.0/19"
            }, 
            "Az1PublicCidr": {
                "Default": "10.0.0.0/19", 
                "Type": "String", 
                "Description": "VPC Public CIDR Block, default is 10.0.0.0/19"
            }, 
            "VpcAz2": {
                "Type": "AWS::EC2::AvailabilityZone::Name", 
                "Description": "VPC AZ 2"
            }, 
            "VpcAz3": {
                "Type": "AWS::EC2::AvailabilityZone::Name", 
                "Description": "VPC AZ 3"
            }, 
            "VpcAz1": {
                "Type": "AWS::EC2::AvailabilityZone::Name", 
                "Description": "VPC AZ 1"
            }
        }, 
        "Description": "VPC Template", 
        "Resources": {
            "PublicRouteTable": {
                "Type": "AWS::EC2::RouteTable", 
                "Properties": {
                    "VpcId": {
                        "Ref": "Vpc"
                    }, 
                    "Tags": [
                        {
                            "Value": "PublicRouteTable", 
                            "Key": "Name"
                        }
                    ]
                }
            }, 
            "PrivateSubnetAz1": {
                "Type": "AWS::EC2::Subnet", 
                "Properties": {
                    "Tags": [
                        {
                            "Value": "Private Subnet AZ 1", 
                            "Key": "Name"
                        }, 
                        {
                            "Value": "private", 
                            "Key": "Network"
                        }
                    ], 
                    "VpcId": {
                        "Ref": "Vpc"
                    }, 
                    "CidrBlock": {
                        "Ref": "Az1PrivateCidr"
                    }, 
                    "AvailabilityZone": {
                        "Ref": "VpcAz1"
                    }
                }
            }, 
            "SubnetRouteTableAssociation1": {
                "Type": "AWS::EC2::SubnetRouteTableAssociation", 
                "Properties": {
                    "SubnetId": {
                        "Ref": "PublicSubnetAz1"
                    }, 
                    "RouteTableId": {
                        "Ref": "PublicRouteTable"
                    }
                }
            }, 
            "SubnetRouteTableAssociation3": {
                "Type": "AWS::EC2::SubnetRouteTableAssociation", 
                "Properties": {
                    "SubnetId": {
                        "Ref": "PublicSubnetAz3"
                    }, 
                    "RouteTableId": {
                        "Ref": "PublicRouteTable"
                    }
                }
            }, 
            "SubnetRouteTableAssociation2": {
                "Type": "AWS::EC2::SubnetRouteTableAssociation", 
                "Properties": {
                    "SubnetId": {
                        "Ref": "PublicSubnetAz2"
                    }, 
                    "RouteTableId": {
                        "Ref": "PublicRouteTable"
                    }
                }
            }, 
            "PublicRoute": {
                "Type": "AWS::EC2::Route", 
                "Properties": {
                    "GatewayId": {
                        "Ref": "InternetGateway"
                    }, 
                    "DestinationCidrBlock": "0.0.0.0/0", 
                    "RouteTableId": {
                        "Ref": "PublicRouteTable"
                    }
                }, 
                "DependsOn": "InternetGateway"
            }, 
            "AppServerSecurityGroup": {
                "Type": "AWS::EC2::SecurityGroup", 
                "Properties": {
                    "SecurityGroupIngress": [
                        {
                            "ToPort": "80", 
                            "IpProtocol": "tcp", 
                            "CidrIp": "0.0.0.0/0", 
                            "FromPort": "80"
                        }, 
                        {
                            "ToPort": "443", 
                            "IpProtocol": "tcp", 
                            "CidrIp": "0.0.0.0/0", 
                            "FromPort": "443"
                        }
                    ], 
                    "VpcId": {
                        "Ref": "Vpc"
                    }, 
                    "GroupDescription": "Allow http/s to client host", 
                    "Tags": [
                        {
                            "Value": "AppServerSecurityGroup", 
                            "Key": "Name"
                        }
                    ]
                }
            }, 
            "PublicSubnetAz1": {
                "Type": "AWS::EC2::Subnet", 
                "Properties": {
                    "Tags": [
                        {
                            "Value": "Public Subnet AZ 1", 
                            "Key": "Name"
                        }, 
                        {
                            "Value": "public", 
                            "Key": "Network"
                        }
                    ], 
                    "VpcId": {
                        "Ref": "Vpc"
                    }, 
                    "CidrBlock": {
                        "Ref": "Az1PublicCidr"
                    }, 
                    "AvailabilityZone": {
                        "Ref": "VpcAz1"
                    }
                }
            }, 
            "PublicSubnetAz2": {
                "Type": "AWS::EC2::Subnet", 
                "Properties": {
                    "Tags": [
                        {
                            "Value": "Public Subnet AZ 2", 
                            "Key": "Name"
                        }, 
                        {
                            "Value": "public", 
                            "Key": "Network"
                        }
                    ], 
                    "VpcId": {
                        "Ref": "Vpc"
                    }, 
                    "CidrBlock": {
                        "Ref": "Az2PublicCidr"
                    }, 
                    "AvailabilityZone": {
                        "Ref": "VpcAz2"
                    }
                }
            }, 
            "PublicSubnetAz3": {
                "Type": "AWS::EC2::Subnet", 
                "Properties": {
                    "Tags": [
                        {
                            "Value": "Public Subnet AZ 3", 
                            "Key": "Name"
                        }, 
                        {
                            "Value": "Public", 
                            "Key": "Network"
                        }
                    ], 
                    "VpcId": {
                        "Ref": "Vpc"
                    }, 
                    "CidrBlock": {
                        "Ref": "Az3PublicCidr"
                    }, 
                    "AvailabilityZone": {
                        "Ref": "VpcAz3"
                    }
                }
            }, 
            "InternetGateway": {
                "Type": "AWS::EC2::InternetGateway"
            }, 
            "PrivateRouteTable": {
                "Type": "AWS::EC2::RouteTable", 
                "Properties": {
                    "VpcId": {
                        "Ref": "Vpc"
                    }, 
                    "Tags": [
                        {
                            "Value": "PrivateRouteTable", 
                            "Key": "Name"
                        }
                    ]
                }
            }, 
            "Vpc": {
                "Type": "AWS::EC2::VPC", 
                "Properties": {
                    "CidrBlock": {
                        "Ref": "VpcCidr"
                    }
                }
            }, 
            "PrivateSubnetAz2": {
                "Type": "AWS::EC2::Subnet", 
                "Properties": {
                    "Tags": [
                        {
                            "Value": "Private Subnet AZ 2", 
                            "Key": "Name"
                        }, 
                        {
                            "Value": "private", 
                            "Key": "Network"
                        }
                    ], 
                    "VpcId": {
                        "Ref": "Vpc"
                    }, 
                    "CidrBlock": {
                        "Ref": "Az2PrivateCidr"
                    }, 
                    "AvailabilityZone": {
                        "Ref": "VpcAz2"
                    }
                }
            }, 
            "PrivateSubnetAz3": {
                "Type": "AWS::EC2::Subnet", 
                "Properties": {
                    "Tags": [
                        {
                            "Value": "Private Subnet AZ 3", 
                            "Key": "Name"
                        }, 
                        {
                            "Value": "private", 
                            "Key": "Network"
                        }
                    ], 
                    "VpcId": {
                        "Ref": "Vpc"
                    }, 
                    "CidrBlock": {
                        "Ref": "Az3PrivateCidr"
                    }, 
                    "AvailabilityZone": {
                        "Ref": "VpcAz3"
                    }
                }
            }, 
            "InternetGatewayAttachment": {
                "Type": "AWS::EC2::VPCGatewayAttachment", 
                "Properties": {
                    "VpcId": {
                        "Ref": "Vpc"
                    }, 
                    "InternetGatewayId": {
                        "Ref": "InternetGateway"
                    }
                }
            }
        }
    }
}
